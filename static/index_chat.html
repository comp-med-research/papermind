<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PaperMind - AI Reading Assistant for ADHD</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf_viewer.min.css">
    <link rel="stylesheet" href="/static/css/styles.css">
    <link rel="stylesheet" href="/static/css/chat.css">
</head>
<body>
    <div class="main-layout" id="mainLayout">
        <!-- PDF Viewer -->
        <div id="pdfViewerContainer" class="pdf-viewer-container panel-left hidden">
            <div class="session-controls">
                <h2 style="color: #667eea; margin: 0;">ğŸ“„ Document</h2>
                <button class="home-btn" onclick="goHome()">ğŸ  Home</button>
            </div>
            <div class="pdf-canvas-wrapper">
                <div class="pdf-display">
                    <div id="readingIndicator" class="reading-indicator hidden">
                        ğŸ¯ Reading this section...
                    </div>
                    <div id="pdfContainer" class="pdf-container">
                        <canvas id="pdfCanvas"></canvas>
                        <div id="textLayer" class="textLayer"></div>
                    </div>
                </div>
            </div>
            <div class="pdf-controls">
                <button id="prevPageBtn" class="btn btn-secondary">â—€ Previous</button>
                <div class="pdf-page-info">
                    <span>Page <span id="pageNum">1</span> of <span id="pageCount">1</span></span>
                </div>
                <button id="nextPageBtn" class="btn btn-secondary">Next â–¶</button>
                <div class="pdf-zoom-controls">
                    <button id="zoomOutBtn" class="btn btn-secondary" title="Zoom Out">ğŸ”âˆ’</button>
                    <span id="zoomLevel" class="zoom-level">150%</span>
                    <button id="zoomInBtn" class="btn btn-secondary" title="Zoom In">ğŸ”+</button>
                    <button id="resetZoomBtn" class="btn btn-secondary" title="Reset Zoom">âŸ²</button>
                </div>
            </div>
        </div>

        <!-- Resizable divider -->
        <div id="panelResizer" class="panel-resizer hidden" title="Drag to resize"></div>

        <!-- Chat Panel -->
        <div class="container sidebar panel-right">
            <!-- Upload Section -->
            <div id="uploadSection">
                <div class="chat-header">
                    <h1>ğŸ“š PaperMind</h1>
                    <p>AI-Powered Reading Assistant for ADHD</p>
                </div>
                
                <div class="upload-section">
                    <h2>ğŸ“„ Upload Your PDF</h2>
                    <p style="margin: 20px 0; color: #666;">Drag and drop your research paper here, or click to browse</p>
                    <input type="file" id="fileInput" accept=".pdf">
                    <button class="upload-btn" onclick="document.getElementById('fileInput').click()">
                        Choose PDF File
                    </button>
                    <div id="uploadStatus" class="loading hidden">
                        <div class="spinner"></div>
                        <p>Processing your PDF...</p>
                    </div>
                </div>
            </div>

            <!-- Chat Section -->
            <div id="chatSection" class="chat-container hidden">
                <div class="chat-header">
                    <h1>ğŸ“š PaperMind</h1>
                    <p>Ask me anything about the paper</p>
                    <div class="chat-header-buttons">
                        <button id="exportPodcastBtn" class="home-btn" onclick="exportPodcast()" title="Generate podcast (MP3) from paper">ğŸ™ï¸ Export as Podcast</button>
                        <button class="home-btn" onclick="goHome()">ğŸ  End Session</button>
                    </div>
                </div>

                <!-- Reading Controls -->
                <div class="reading-controls">
                    <button id="startBtn" class="btn btn-primary" onclick="startReading()">â–¶ï¸ Start Reading</button>
                    <button id="pauseBtn" class="btn btn-secondary hidden" onclick="pauseReading()">â¸ï¸ Pause</button>
                    <button id="resumeBtn" class="btn btn-primary hidden" onclick="resumeReading()">â–¶ï¸ Continue</button>
                </div>

                <!-- Reading Status -->
                <div id="readingStatus" class="reading-status hidden">
                    ğŸ“– Reading: <span id="currentSentencePreview"></span>
                </div>

                <!-- Podcast Player (shown when podcast is ready) -->
                <div id="podcastPlayer" class="podcast-player hidden">
                    <h4 class="podcast-player-title">ğŸ™ï¸ Paper Podcast</h4>
                    <audio id="podcastAudio" controls class="podcast-audio"></audio>
                    <div class="podcast-actions">
                        <a id="podcastDownload" class="action-btn" download="papermind-podcast.mp3">â¬‡ï¸ Download</a>
                    </div>
                    <details class="podcast-transcript">
                        <summary>ğŸ“œ Transcript</summary>
                        <pre id="podcastTranscript" class="podcast-transcript-text"></pre>
                    </details>
                </div>

                <!-- Chat Messages -->
                <div id="chatMessages" class="chat-messages">
                    <div class="chat-empty-state">
                        <div class="icon">ğŸ’¬</div>
                        <h3>Start a conversation</h3>
                        <p>Click "Start Reading" to begin, or ask me any question about the paper!</p>
                    </div>
                </div>

                <!-- Chat Input -->
                <div class="chat-input-area">
                    <!-- Response Type Selector -->
                    <div class="response-type-selector">
                        <div class="response-type-chip active" data-type="text" onclick="toggleResponseType('text')">
                            ğŸ“ Text
                        </div>
                        <div class="response-type-chip active" data-type="voice" onclick="toggleResponseType('voice')">
                            ğŸ”Š Voice
                        </div>
                        <div class="response-type-chip" data-type="image" onclick="toggleResponseType('image')">
                            ğŸ–¼ï¸ Image
                        </div>
                        <div class="response-type-chip" data-type="video" onclick="toggleResponseType('video')">
                            ğŸ¥ Video
                        </div>
                    </div>

                    <!-- Input Area -->
                    <div class="chat-input-wrapper">
                        <textarea id="chatInput" class="chat-input" placeholder="Ask a question about the paper..." rows="1"></textarea>
                        <div class="chat-input-buttons">
                            <button id="voiceBtn" class="voice-btn" title="Voice input">ğŸ¤</button>
                            <button id="sendBtn" class="send-btn">Send</button>
                        </div>
                    </div>

                    <!-- Progress Stats -->
                    <div class="stats">
                        <div class="stat-item">
                            <div id="statPosition" class="stat-value">0</div>
                            <div class="stat-label">Sentences Read</div>
                        </div>
                        <div class="stat-item">
                            <div id="statQuestions" class="stat-value">0</div>
                            <div class="stat-label">Questions Asked</div>
                        </div>
                        <div class="stat-item">
                            <div id="statProgress" class="stat-value">0%</div>
                            <div class="stat-label">Progress</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script type="module" src="/static/js/app_chat.js"></script>
</body>
</html>
