<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PaperMind - AI Reading Assistant for ADHD</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf_viewer.min.css">
    <link rel="stylesheet" href="/static/css/styles.css">
    <link rel="stylesheet" href="/static/css/chat.css">
</head>
<body>
    <div class="main-layout main-layout-three-panel" id="mainLayout">
        <!-- Panel 1: Sources -->
        <div id="sourcesPanel" class="panel panel-sources">
            <div class="sources-header">
                <h2>ğŸ“„ Sources</h2>
                <button id="sourcesCollapseBtn" class="panel-collapse-btn" onclick="togglePanel('sources')" title="Collapse Sources panel">âŠŸ</button>
            </div>
            <div id="uploadSection" class="sources-content">
                <div class="upload-section">
                    <h3>Upload Your PDF</h3>
                    <p style="margin: 20px 0; color: #666;">Drag and drop your research paper here, or click to browse</p>
                    <input type="file" id="fileInput" accept=".pdf" style="display:none">
                    <label for="fileInput" class="upload-btn" style="cursor:pointer;display:inline-block">
                        + Add sources
                    </label>
                    <div id="uploadStatus" class="loading hidden">
                        <div class="spinner"></div>
                        <p>Processing your PDF...</p>
                    </div>
                </div>
            </div>
            <div id="pdfViewerContainer" class="pdf-viewer-container hidden">
                <div class="session-controls">
                    <h2 style="color: #667eea; margin: 0;">ğŸ“„ Sources</h2>
                    <button id="playPauseBtn" class="btn btn-primary play-pause-btn" onclick="togglePlayPause()" title="Play / Pause reading">â–¶ï¸ Start Reading</button>
                    <button class="home-btn" onclick="goHome()">ğŸ  End Session</button>
                </div>
                <div class="pdf-canvas-wrapper">
                    <div class="pdf-display">
                        <div id="readingIndicator" class="reading-indicator hidden">
                            ğŸ¯ Reading this section...
                        </div>
                        <div id="pdfContainer" class="pdf-container">
                            <canvas id="pdfCanvas"></canvas>
                            <div id="textLayer" class="textLayer"></div>
                        </div>
                    </div>
                </div>
                <div class="pdf-controls">
                    <button id="prevPageBtn" class="btn btn-secondary">â—€ Previous</button>
                    <div class="pdf-page-info">
                        <span>Page <span id="pageNum">1</span> of <span id="pageCount">1</span></span>
                    </div>
                    <button id="nextPageBtn" class="btn btn-secondary">Next â–¶</button>
                    <div class="pdf-zoom-controls">
                        <button id="zoomOutBtn" class="btn btn-secondary" title="Zoom Out">ğŸ”âˆ’</button>
                        <span id="zoomLevel" class="zoom-level">125%</span>
                        <button id="zoomInBtn" class="btn btn-secondary" title="Zoom In">ğŸ”+</button>
                        <button id="resetZoomBtn" class="btn btn-secondary" title="Reset Zoom">âŸ²</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Resizer 1: Sources | Chat -->
        <div id="resizer1" class="panel-resizer resizer-notebooklm" title="Drag to resize"></div>

        <!-- Panel 2: Chat -->
        <div id="chatPanel" class="panel panel-chat">
            <div id="chatSection" class="chat-container">
                <div class="chat-header">
                    <div>
                        <h2>Chat</h2>
                        <p>Ask me anything about the paper</p>
                    </div>
                    <button class="home-btn chat-end-session" onclick="goHome()">ğŸ  End Session</button>
                </div>
                <div id="readingStatus" class="reading-status hidden">
                    ğŸ“– Reading: <span id="currentSentencePreview"></span>
                </div>
                <div id="chatMessages" class="chat-messages">
                    <div class="chat-empty-state">
                        <div class="icon">ğŸ’¬</div>
                        <h3>Start a conversation</h3>
                        <p>Upload a PDF in Sources, then click "Start Reading" or ask a question!</p>
                    </div>
                </div>
                <div class="chat-input-area">
                    <div class="response-type-selector">
                        <div class="response-type-chip active" data-type="text" onclick="toggleResponseType('text')">ğŸ“ Text</div>
                        <div class="response-type-chip active" data-type="voice" onclick="toggleResponseType('voice')">ğŸ”Š Voice</div>
                        <div class="response-type-chip" data-type="image" onclick="toggleResponseType('image')">ğŸ–¼ï¸ Image</div>
                        <div class="response-type-chip" data-type="video" onclick="toggleResponseType('video')">ğŸ¥ Video</div>
                    </div>
                    <div class="chat-input-wrapper">
                        <textarea id="chatInput" class="chat-input" placeholder="Ask a question about the paper..." rows="1"></textarea>
                        <div class="chat-input-buttons">
                            <button id="voiceBtn" class="voice-btn" title="Voice input">ğŸ¤</button>
                            <button id="sendBtn" class="send-btn">Send</button>
                        </div>
                    </div>
                    <div class="stats">
                        <div class="stat-item">
                            <div id="statPosition" class="stat-value">0</div>
                            <div class="stat-label">Sentences Read</div>
                        </div>
                        <div class="stat-item">
                            <div id="statQuestions" class="stat-value">0</div>
                            <div class="stat-label">Questions Asked</div>
                        </div>
                        <div class="stat-item">
                            <div id="statProgress" class="stat-value">0%</div>
                            <div class="stat-label">Progress</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Resizer 2: Chat | Studio -->
        <div id="resizer2" class="panel-resizer resizer-notebooklm" title="Drag to resize"></div>

        <!-- Panel 3: Studio -->
        <div id="studioPanel" class="panel panel-studio">
            <div class="studio-header">
                <h2>Studio</h2>
                <button id="studioCollapseBtn" class="panel-collapse-btn" onclick="togglePanel('studio')" title="Collapse Studio panel">âŠŸ</button>
            </div>
            <div class="studio-actions">
                <button id="exportPodcastBtn" class="studio-action-btn" onclick="exportAudioOverview()" title="Generate audio overview">
                    <span class="studio-action-icon">ğŸ™ï¸</span>
                    <span>Audio Overview</span>
                </button>
                <button id="exportVideoBtn" class="studio-action-btn" onclick="exportVideoOverview()" title="Generate video overview">
                    <span class="studio-action-icon">ğŸ¬</span>
                    <span>Video Overview</span>
                </button>
            </div>
            <div class="studio-output">
                <div id="podcastPlayer" class="podcast-player hidden">
                    <h4 class="podcast-player-title">ğŸ™ï¸ Audio Overview</h4>
                    <audio id="podcastAudio" controls class="podcast-audio"></audio>
                    <div class="podcast-actions">
                        <a id="podcastDownload" class="action-btn" download="papermind-audio-overview.mp3">â¬‡ï¸ Download</a>
                    </div>
                    <details class="podcast-transcript">
                        <summary>ğŸ“œ Transcript</summary>
                        <pre id="podcastTranscript" class="podcast-transcript-text"></pre>
                    </details>
                </div>
                <div id="videoOverviewPlayer" class="podcast-player hidden">
                    <h4 class="podcast-player-title">ğŸ¬ Video Overview</h4>
                    <video id="videoOverviewVideo" class="video-overview-player" controls></video>
                    <div class="podcast-actions">
                        <a id="videoOverviewDownload" class="action-btn" download="papermind-video-overview.mp4">â¬‡ï¸ Download</a>
                    </div>
                </div>
                <div id="studioEmptyState" class="studio-empty-state">
                    <p>Generate an Audio or Video overview from your paper.</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script type="module" src="/static/js/app_chat.js"></script>
</body>
</html>
