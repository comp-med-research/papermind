<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PaperMind - AI Reading Assistant for ADHD</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf_viewer.min.css">
    <link rel="stylesheet" href="/static/css/styles.css?v=80">
    <link rel="stylesheet" href="/static/css/chat.css?v=84">
</head>
<body>
    <div class="main-layout main-layout-three-panel" id="mainLayout">
        <!-- Panel 1: Sources -->
        <div id="sourcesPanel" class="panel panel-sources">
            <div class="sources-header">
                <h2>üìÑ Sources</h2>
                <button id="sourcesCollapseBtn" class="panel-collapse-btn" onclick="togglePanel('sources')" title="Collapse Sources panel">‚äü</button>
            </div>
            <div id="uploadSection" class="sources-content">
                <div class="upload-section">
                    <h3>Upload Your PDF</h3>
                    <p style="margin: 20px 0; color: #666;">Drag and drop your research paper here, or click to browse</p>
                    <input type="file" id="fileInput" accept=".pdf" style="display:none">
                    <label for="fileInput" class="upload-btn" style="cursor:pointer;display:inline-block">
                        + Add sources
                    </label>
                    <div id="uploadStatus" class="loading hidden">
                        <div class="spinner"></div>
                        <p>Processing your PDF...</p>
                    </div>
                </div>
            </div>
            <div id="pdfViewerContainer" class="pdf-viewer-container hidden">
                <button class="pdf-close-btn" onclick="goHome()" title="End session">√ó</button>
                <div class="pdf-canvas-wrapper">
                    <div class="pdf-display">
                        <div id="readingIndicator" class="reading-indicator hidden"></div>
                        <div id="pdfContainer" class="pdf-container">
                            <canvas id="pdfCanvas"></canvas>
                            <div id="textLayer" class="textLayer"></div>
                        </div>
                    </div>
                </div>
                <div class="pdf-controls">
                    <button id="prevPageBtn" class="btn btn-secondary" title="Previous page">‚óÄ</button>
                    <div class="pdf-page-info">
                        <span><span id="pageNum">1</span>/<span id="pageCount">1</span></span>
                    </div>
                    <button id="nextPageBtn" class="btn btn-secondary" title="Next page">‚ñ∂</button>
                    <div class="pdf-zoom-controls">
                        <button id="zoomOutBtn" class="btn btn-secondary" title="Zoom Out">üîç‚àí</button>
                        <span id="zoomLevel" class="zoom-level">75%</span>
                        <button id="zoomInBtn" class="btn btn-secondary" title="Zoom In">üîç+</button>
                        <button id="resetZoomBtn" class="btn btn-secondary" title="Reset Zoom">‚ü≤</button>
                    </div>
                    <button id="playPauseBtn" class="btn btn-secondary pdf-play-toggle" onclick="togglePlayPause()" title="Play / Pause reading">‚ñ∂</button>
                </div>
            </div>
        </div>

        <!-- Resizer 1: Sources | Chat -->
        <div id="resizer1" class="panel-resizer resizer-notebooklm" title="Drag to resize"></div>

        <!-- Panel 2: Chat -->
        <div id="chatPanel" class="panel panel-chat">
            <div id="chatSection" class="chat-container">
                <div class="chat-header">
                    <div>
                        <h2>Chat</h2>
                        <p>Ask me anything about the paper</p>
                    </div>
                    <button id="liveTalkBtn" class="live-talk-btn talk-idle" title="Start voice conversation">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></svg>
                        Talk
                    </button>
                    <span id="talkStatus" class="talk-status hidden"></span>
                    <button class="home-btn chat-delete-btn" onclick="deleteChat()">Delete Chat</button>
                </div>
                <div id="readingStatus" class="reading-status hidden">
                    <span id="currentSentencePreview"></span>
                </div>
                <div id="chatMessages" class="chat-messages">
                    <div class="chat-empty-state">
                        <div class="icon">üí¨</div>
                        <h3>Start a conversation</h3>
                        <p>Upload a PDF in Sources, then click "Start Reading" or ask a question!</p>
                    </div>
                </div>
                <div class="chat-input-area">
                    <div class="response-type-selector">
                        <div class="response-type-chip active" data-type="text" onclick="toggleResponseType('text')">üìù Text</div>
                        <div class="response-type-chip" data-type="image" onclick="toggleResponseType('image')">üñºÔ∏è Image</div>
                        <div class="response-type-chip" data-type="video" onclick="toggleResponseType('video')">üé• Video</div>
                    </div>
                    <div class="chat-input-wrapper">
                        <textarea id="chatInput" class="chat-input" placeholder="Ask a question about the paper..." rows="1"></textarea>
                        <div class="chat-input-buttons">
                            <button id="voiceBtn" class="voice-btn" title="Voice input">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></svg>
                            </button>
                            <button id="sendBtn" class="send-btn">Send</button>
                        </div>
                    </div>
                    <div class="stats">
                        <div class="stat-item">
                            <div id="statPosition" class="stat-value">0</div>
                            <div class="stat-label">Sentences Read</div>
                        </div>
                        <div class="stat-item">
                            <div id="statQuestions" class="stat-value">0</div>
                            <div class="stat-label">Questions Asked</div>
                        </div>
                        <div class="stat-item">
                            <div id="statProgress" class="stat-value">0%</div>
                            <div class="stat-label">Progress</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Resizer 2: Chat | Studio -->
        <div id="resizer2" class="panel-resizer resizer-notebooklm" title="Drag to resize"></div>

        <!-- Panel 3: Studio -->
        <div id="studioPanel" class="panel panel-studio">
            <div class="studio-header">
                <h2>Studio</h2>
                <button id="studioCollapseBtn" class="panel-collapse-btn" onclick="togglePanel('studio')" title="Collapse Studio panel">‚äü</button>
            </div>
            <div class="studio-actions">
                <button id="exportPodcastBtn" class="studio-action-btn" onclick="exportAudioOverview()" title="Generate audio overview">
                    <span class="studio-action-icon">üéôÔ∏è</span>
                    <span>Audio Overview</span>
                </button>
                <button id="exportVideoBtn" class="studio-action-btn" onclick="exportVideoOverview()" title="Generate video overview">
                    <span class="studio-action-icon">üé¨</span>
                    <span>Video Overview</span>
                </button>
            </div>
            <div class="studio-output">
                <div id="podcastPlayer" class="podcast-player hidden">
                    <h4 class="podcast-player-title">üéôÔ∏è Audio Overview</h4>
                    <audio id="podcastAudio" controls class="podcast-audio"></audio>
                    <div class="podcast-actions">
                        <a id="podcastDownload" class="action-btn" download="papermind-audio-overview.mp3">‚¨áÔ∏è Download</a>
                    </div>
                    <details class="podcast-transcript">
                        <summary>üìú Transcript</summary>
                        <pre id="podcastTranscript" class="podcast-transcript-text"></pre>
                    </details>
                </div>
                <div id="videoOverviewPlayer" class="podcast-player hidden">
                    <h4 class="podcast-player-title">üé¨ Video Overview</h4>
                    <video id="videoOverviewVideo" class="video-overview-player" controls></video>
                    <div class="podcast-actions">
                        <a id="videoOverviewDownload" class="action-btn" download="papermind-video-overview.mp4">‚¨áÔ∏è Download</a>
                    </div>
                </div>
                <div id="studioEmptyState" class="studio-empty-state">
                    <p>Generate an Audio or Video overview from your paper.</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script type="module" src="/static/js/app_chat.js?v=84"></script>
</body>
</html>
